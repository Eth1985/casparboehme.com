<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>40 Hours with Caspar</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #0a0a0a;
            color: #e8e8e8;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
            overflow: hidden;
            touch-action: none;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        #canvas-container {
            position: fixed;
            inset: 0;
            cursor: grab;
        }

        #canvas-container.dragging {
            cursor: grabbing;
        }

        .ui-overlay {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 10;
        }

        /* Header with sophisticated animation */
        .header {
            position: absolute;
            top: 6vh;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            width: 90%;
            z-index: 5;
        }

        .title {
            font-size: clamp(1.4rem, 5vw, 2.8rem);
            font-weight: 600;
            letter-spacing: -0.02em;
            line-height: 1.05;
            color: #f5f5f7;
        }

        @media (max-width: 768px) {
            .title {
                font-size: clamp(1.1rem, 5.5vw, 1.8rem);
            }
        }

        /* Center Event Info */
        .center-info {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            opacity: 0;
            pointer-events: none;
            max-width: 85vw;
        }

        .center-info.show {
            opacity: 1;
            pointer-events: auto;
        }

        .center-event {
            font-size: clamp(0.75rem, 2.2vw, 0.9rem);
            color: #86868b;
            letter-spacing: 0.01em;
            margin-bottom: 0.6rem;
            font-weight: 500;
            line-height: 1.3;
        }

        .center-date {
            font-size: clamp(0.65rem, 1.8vw, 0.75rem);
            color: #6e6e73;
            letter-spacing: 0.02em;
            margin-bottom: 0.8rem;
            font-weight: 400;
            text-transform: uppercase;
        }

        .center-time {
            font-size: clamp(2.2rem, 9vw, 3.5rem);
            font-weight: 300;
            letter-spacing: -0.02em;
            margin-bottom: 0.4rem;
            line-height: 1;
            color: #f5f5f7;
        }

        .center-location {
            font-size: clamp(0.75rem, 2vw, 0.85rem);
            color: #86868b;
            letter-spacing: 0.01em;
            margin-bottom: 1.8rem;
            font-weight: 400;
        }


        /* Monochrome RSVP Button */
        .rsvp-button {
            display: inline-block;
            padding: clamp(0.8rem, 3vw, 1rem) clamp(2rem, 8vw, 3rem);
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 50px;
            color: #e8e8e8;
            font-size: clamp(0.75rem, 2.5vw, 0.9rem);
            letter-spacing: 0.15em;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: auto;
            backdrop-filter: blur(10px);
            font-weight: 300;
        }

        .rsvp-button:hover,
        .rsvp-button:active {
            background: rgba(255, 255, 255, 0.03);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        /* RSVP Modal */
        .rsvp-modal {
            position: fixed;
            inset: 0;
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(20px);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .rsvp-modal.show {
            opacity: 1;
            pointer-events: auto;
        }

        .rsvp-content {
            max-width: 90vw;
            width: 400px;
            text-align: center;
            transform: scale(0.9);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .rsvp-modal.show .rsvp-content {
            transform: scale(1);
        }

        .rsvp-event-title {
            font-size: clamp(1.5rem, 5vw, 2rem);
            font-weight: 200;
            margin-bottom: 0.5rem;
            letter-spacing: -0.01em;
        }

        .rsvp-event-time {
            font-size: clamp(0.9rem, 3vw, 1.1rem);
            color: #666;
            margin-bottom: 2rem;
            letter-spacing: 0.05em;
        }

        .rsvp-form {
            margin-bottom: 2rem;
        }

        .rsvp-input {
            width: 100%;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #e8e8e8;
            font-size: 1rem;
            font-family: inherit;
            margin-bottom: 1rem;
            transition: all 0.3s;
        }

        .rsvp-input:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.05);
        }

        .rsvp-input::placeholder {
            color: #444;
        }

        .rsvp-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .rsvp-submit, .rsvp-close {
            padding: 1rem 2.5rem;
            border-radius: 50px;
            font-size: 0.9rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: inherit;
            font-weight: 300;
        }

        .rsvp-submit {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #e8e8e8;
        }

        .rsvp-submit:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-1px);
        }

        .rsvp-close {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #888;
        }

        .rsvp-close:hover {
            border-color: rgba(255, 255, 255, 0.2);
        }

        /* Mobile optimizations */
        @media (max-width: 768px) {
            .header {
                top: 8vh;
            }

            .center-time {
                margin-bottom: 0.5rem;
            }

            .center-duration {
                margin-bottom: 1.5rem;
            }

            .rsvp-buttons {
                flex-direction: column;
            }

            .rsvp-submit, .rsvp-close {
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .header {
                top: 6vh;
            }
        }

        @media (max-height: 700px) {
            .header {
                top: 5vh;
            }
        }

        @media (max-height: 600px) {
            .header {
                top: 3vh;
            }
        }
    </style>
</head>
<body>
    <div id="canvas-container"></div>

    <div class="ui-overlay">
        <div class="header">
            <h1 class="title">40 Hours Caspar</h1>
        </div>

        <div class="center-info" id="centerInfo">
            <div class="center-event" id="centerEvent">Bowling</div>
            <div class="center-date" id="centerDate">November 12</div>
            <div class="center-time" id="centerTime">20:00</div>
            <div class="center-location" id="centerLocation">Berolina</div>
            <button class="rsvp-button" id="rsvpButton">RSVP</button>
        </div>
    </div>

    <!-- RSVP Modal -->
    <div class="rsvp-modal" id="rsvpModal">
        <div class="rsvp-content">
            <h2 class="rsvp-event-title" id="modalEventTitle">Bowling</h2>
            <p class="rsvp-event-time" id="modalEventTime">November 12 • 20:00 • Berolina</p>

            <form class="rsvp-form" id="rsvpForm">
                <input type="text" class="rsvp-input" placeholder="Your name" required id="rsvpName">
                <input type="text" class="rsvp-input" placeholder="Plus ones (optional)" id="rsvpPlusOnes">
            </form>

            <div class="rsvp-buttons">
                <button class="rsvp-submit" id="rsvpSubmit">Confirm</button>
                <button class="rsvp-close" id="rsvpClose">Close</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <script>
        const events = [
            { date: 'November 12', time: '20:00', endTime: '22:00', title: 'Bowling', location: 'Berolina', color: 0x666666 },
            { date: 'November 12', time: '22:30', endTime: '23:59', title: 'New Oldtimer', location: 'Open end', color: 0x666666 },
            { date: 'November 13', time: '11:30', endTime: '14:00', title: 'Brunch', location: 'Mommseneck', color: 0x666666 },
            { date: 'November 13', time: '14:00', endTime: '18:00', title: 'Art Walk', location: 'Charlottenburg', color: 0x666666 },
            { date: 'November 13', time: '19:00', endTime: '20:00', title: 'Workout', location: 'Ride.bln', color: 0x666666 },
            { date: 'November 13', time: '20:30', endTime: '22:30', title: 'Dinner', location: 'Ming Dynastie', color: 0x666666 },
            { date: 'November 13', time: '23:00', endTime: '01:00', title: 'Drinks', location: 'Viktoria Bar', color: 0x666666 }
        ];

        // Scene setup

        // Scene setup - PROPER responsive sizing that works on ANY device
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();

        // Calculate available space for ring - different for mobile vs desktop
        function calculateRingSize() {
            const vw = window.innerWidth;
            const vh = window.innerHeight;
            const isMobile = vw < 768;

            let headerSpace, bottomMargin, sideMargin, ringScale;

            if (isMobile) {
                // Mobile: move ring down, make room for title at top
                headerSpace = vh * 0.22; // More space at top for title
                bottomMargin = vh * 0.10; // Less space at bottom (ring moves down)
                sideMargin = vw * 0.08;
                ringScale = 0.90; // Fill 90% of available space
            } else {
                // Desktop: smaller ring, centered nicely
                headerSpace = vh * 0.25;
                bottomMargin = vh * 0.15;
                sideMargin = vw * 0.20; // More side margins on desktop
                ringScale = 0.65; // Smaller on desktop (65% of space)
            }

            // Available space for ring
            const availableHeight = vh - headerSpace - bottomMargin;
            const availableWidth = vw - (sideMargin * 2);

            // Ring should fit in the smaller dimension
            const maxDiameter = Math.min(availableHeight, availableWidth) * ringScale;

            // Convert to Three.js units
            const ringRadiusInUnits = 2.5;
            const cameraDistance = ringRadiusInUnits / Math.tan((50 * Math.PI / 180) / 2) * (600 / maxDiameter);

            return {
                radius: ringRadiusInUnits,
                cameraZ: cameraDistance,
                isMobile: isMobile
            };
        }

        const ringSize = calculateRingSize();
        const ringRadius = ringSize.radius;

        const camera = new THREE.PerspectiveCamera(
            50, // Fixed FOV for consistent perspective
            window.innerWidth / window.innerHeight,
            0.1,
            1000
        );
        camera.position.z = ringSize.cameraZ;

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        container.appendChild(renderer.domElement);

        // Main ring - smaller, fits screen
        const ringGeometry = new THREE.TorusGeometry(ringRadius, 0.04, 32, 100);
        const ringMaterial = new THREE.MeshStandardMaterial({
            color: 0x1a1a1a,
            metalness: 0.7,
            roughness: 0.3,
            emissive: 0x0a0a0a
        });
        const ring = new THREE.Mesh(ringGeometry, ringMaterial);
        scene.add(ring);

        // Time segments - touchable slices
        const segments = [];
        const segmentAngle = (Math.PI * 2) / events.length;

        events.forEach((event, i) => {
            const startAngle = i * segmentAngle;
            const endAngle = (i + 1) * segmentAngle;

            const segmentGeometry = new THREE.TorusGeometry(
                ringRadius - 0.3, 0.12, 16, 32, endAngle - startAngle
            );
            const segmentMaterial = new THREE.MeshStandardMaterial({
                color: 0x888888,
                emissive: 0x888888,
                emissiveIntensity: 0,
                transparent: true,
                opacity: 0.3,
                metalness: 0.5,
                roughness: 0.4
            });

            const segment = new THREE.Mesh(segmentGeometry, segmentMaterial);
            segment.rotation.z = startAngle;
            segment.userData = { index: i, event, isSegment: true };

            segments.push(segment);
            scene.add(segment);
        });

        // Event markers - larger hit area for better touch detection
        const markers = [];
        events.forEach((event, i) => {
            const angle = (i / events.length) * Math.PI * 2;

            // Visible sphere
            const markerGeometry = new THREE.SphereGeometry(0.12, 32, 32);
            const markerMaterial = new THREE.MeshStandardMaterial({
                color: 0x888888,
                emissive: 0x666666,
                emissiveIntensity: 0.2,
                metalness: 0.8,
                roughness: 0.2
            });

            const marker = new THREE.Mesh(markerGeometry, markerMaterial);
            marker.position.x = Math.cos(angle) * ringRadius;
            marker.position.y = Math.sin(angle) * ringRadius;
            marker.userData = { index: i, event };

            // Add invisible larger hit area for easier touching
            const hitAreaGeometry = new THREE.SphereGeometry(0.3, 16, 16);
            const hitAreaMaterial = new THREE.MeshBasicMaterial({
                visible: false
            });
            const hitArea = new THREE.Mesh(hitAreaGeometry, hitAreaMaterial);
            hitArea.userData = { index: i, event };
            marker.add(hitArea);

            markers.push(marker);
            scene.add(marker);
        });

        // Lighting - softer for mobile
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
        scene.add(ambientLight);

        const pointLight = new THREE.PointLight(0xffffff, 0.8, 100);
        pointLight.position.set(5, 5, 5);
        scene.add(pointLight);

        const fillLight = new THREE.PointLight(0xffffff, 0.3, 100);
        fillLight.position.set(-5, -5, 3);
        scene.add(fillLight);

        // Interaction
        let isDragging = false;
        let previousMouseX = 0;
        let rotationVelocity = 0;
        let currentActive = null;

        const raycaster = new THREE.Raycaster();
        raycaster.params.Mesh.threshold = 0.2; // Increase hit detection threshold
        const mouse = new THREE.Vector2();

        function onPointerDown(e) {
            isDragging = true;
            container.classList.add('dragging');
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            previousMouseX = clientX;
            rotationVelocity = 0;
        }

        function onPointerMove(e) {
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;

            mouse.x = (clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(clientY / window.innerHeight) * 2 + 1;

            if (isDragging) {
                const deltaX = clientX - previousMouseX;
                rotationVelocity = deltaX * 0.01;
                previousMouseX = clientX;
            }
        }

        function onPointerUp() {
            isDragging = false;
            container.classList.remove('dragging');
        }

        function checkIntersections() {
            raycaster.setFromCamera(mouse, camera);

            // Check segments AND markers (entire slice is touchable)
            const allObjects = [];

            // Add all segments
            segments.forEach(s => allObjects.push(s));

            // Add markers and their children (hit areas)
            markers.forEach(m => {
                allObjects.push(m);
                m.children.forEach(child => allObjects.push(child));
            });

            const intersects = raycaster.intersectObjects(allObjects);

            if (intersects.length > 0) {
                const index = intersects[0].object.userData.index;
                if (index !== undefined) {
                    activateEvent(index);
                }
            } else if (!isDragging) {
                deactivateEvent();
            }
        }

        function activateEvent(index) {
            if (currentActive === index) return;

            // Deactivate previous
            if (currentActive !== null) {
                gsap.to(segments[currentActive].material, {
                    emissiveIntensity: 0,
                    duration: 0.5
                });
                gsap.to(markers[currentActive].scale, {
                    x: 1, y: 1, z: 1,
                    duration: 0.4,
                    ease: 'power2.out'
                });
                gsap.to(markers[currentActive].material, {
                    emissiveIntensity: 0.2,
                    duration: 0.4
                });
            }

            currentActive = index;
            const event = events[index];

            // Activate segment
            gsap.to(segments[index].material, {
                emissiveIntensity: 0.6,
                duration: 0.6,
                ease: 'power2.out'
            });

            // Scale marker
            gsap.to(markers[index].scale, {
                x: 1.5, y: 1.5, z: 1.5,
                duration: 0.5,
                ease: 'elastic.out(1, 0.5)'
            });

            gsap.to(markers[index].material, {
                emissiveIntensity: 0.8,
                duration: 0.4
            });

            // Update center info with GSAP
            const centerInfo = document.getElementById('centerInfo');
            const centerTime = document.getElementById('centerTime');
            const centerEvent = document.getElementById('centerEvent');
            const centerDate = document.getElementById('centerDate');
            const centerLocation = document.getElementById('centerLocation');

            // Fade out current
            gsap.to(centerInfo, {
                opacity: 0,
                duration: 0.2,
                onComplete: () => {
                    // Update content - line break between title and date
                    centerEvent.textContent = event.title;
                    centerDate.textContent = event.date;
                    centerTime.textContent = event.time;
                    centerLocation.textContent = event.location;

                    // Fade in new
                    centerInfo.classList.add('show');
                    gsap.to(centerInfo, {
                        opacity: 1,
                        duration: 0.5,
                        ease: 'power2.out'
                    });

                    gsap.fromTo(centerTime,
                        { scale: 0.9, opacity: 0 },
                        { scale: 1, opacity: 1, duration: 0.6, ease: 'back.out(1.7)' }
                    );
                }
            });

            // Update RSVP button - show modal
            document.getElementById('rsvpButton').onclick = (e) => {
                e.stopPropagation();
                openRSVPModal(event);
            };

            // Haptic
            if (navigator.vibrate) navigator.vibrate(10);
        }

        function deactivateEvent() {
            if (currentActive === null) return;

            gsap.to(segments[currentActive].material, {
                emissiveIntensity: 0,
                duration: 0.5
            });

            gsap.to(markers[currentActive].scale, {
                x: 1, y: 1, z: 1,
                duration: 0.4,
                ease: 'power2.out'
            });

            gsap.to(markers[currentActive].material, {
                emissiveIntensity: 0.2,
                duration: 0.4
            });

            gsap.to('#centerInfo', {
                opacity: 0,
                duration: 0.3,
                onComplete: () => {
                    document.getElementById('centerInfo').classList.remove('show');
                }
            });

            currentActive = null;
        }

        // Event listeners
        container.addEventListener('mousedown', onPointerDown);
        container.addEventListener('mousemove', onPointerMove);
        container.addEventListener('mouseup', onPointerUp);
        container.addEventListener('touchstart', onPointerDown, { passive: true });
        container.addEventListener('touchmove', onPointerMove, { passive: true });
        container.addEventListener('touchend', onPointerUp);

        // Animation loop
        function animate() {
            requestAnimationFrame(animate);

            if (!isDragging) {
                rotationVelocity *= 0.95;
            }

            ring.rotation.z += rotationVelocity;

            segments.forEach(segment => {
                segment.rotation.z += rotationVelocity;
            });

            markers.forEach(marker => {
                const currentAngle = Math.atan2(marker.position.y, marker.position.x);
                const newAngle = currentAngle + rotationVelocity;
                marker.position.x = Math.cos(newAngle) * ringRadius;
                marker.position.y = Math.sin(newAngle) * ringRadius;
            });

            if (!isDragging) {
                checkIntersections();
            }

            // Subtle pulse
            ring.scale.setScalar(1 + Math.sin(Date.now() * 0.0008) * 0.008);

            renderer.render(scene, camera);
        }

        // RSVP Modal functions
        let currentEventForRSVP = null;

        function openRSVPModal(event) {
            currentEventForRSVP = event;
            document.getElementById('modalEventTitle').textContent = event.title;
            document.getElementById('modalEventTime').textContent = `${event.date} • ${event.time} • ${event.location}`;

            const modal = document.getElementById('rsvpModal');
            gsap.to(modal, {
                opacity: 1,
                duration: 0.4,
                onStart: () => {
                    modal.classList.add('show');
                }
            });
        }

        function closeRSVPModal() {
            const modal = document.getElementById('rsvpModal');
            gsap.to(modal, {
                opacity: 0,
                duration: 0.3,
                onComplete: () => {
                    modal.classList.remove('show');
                    document.getElementById('rsvpName').value = '';
                    document.getElementById('rsvpPlusOnes').value = '';
                }
            });
        }

        function submitRSVP() {
            const name = document.getElementById('rsvpName').value.trim();
            const plusOnes = document.getElementById('rsvpPlusOnes').value.trim();

            if (!name) {
                alert('Please enter your name');
                return;
            }

            // In production, this would call your backend API
            console.log('RSVP Submitted:', {
                event: currentEventForRSVP.title,
                time: currentEventForRSVP.time,
                name,
                plusOnes
            });

            // Show success and close
            alert(`✓ You're confirmed for ${currentEventForRSVP.title}!`);
            closeRSVPModal();
        }

        // RSVP Modal event listeners
        document.getElementById('rsvpClose').addEventListener('click', closeRSVPModal);
        document.getElementById('rsvpSubmit').addEventListener('click', submitRSVP);

        document.getElementById('rsvpForm').addEventListener('submit', (e) => {
            e.preventDefault();
            submitRSVP();
        });

        // Close modal on escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && document.getElementById('rsvpModal').classList.contains('show')) {
                closeRSVPModal();
            }
        });

        // Handle resize - recalculate for ANY screen size
        window.addEventListener('resize', () => {
            const newRingSize = calculateRingSize();
            camera.position.z = newRingSize.cameraZ;
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        animate();
        document.addEventListener('contextmenu', e => e.preventDefault());
    </script>
</body>
</html>
