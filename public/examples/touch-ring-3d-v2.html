<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Touch Ring v2 - With Images & RSVP</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #0a0a0a;
            color: #e8e8e8;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
            overflow: hidden;
            touch-action: none;
        }

        #canvas-container {
            position: fixed;
            inset: 0;
            cursor: grab;
        }

        #canvas-container.dragging {
            cursor: grabbing;
        }

        .ui-overlay {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 10;
        }

        .header {
            position: absolute;
            top: 3rem;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
        }

        .title {
            font-size: clamp(2rem, 5vw, 3.5rem);
            font-weight: 200;
            letter-spacing: -0.02em;
            margin-bottom: 0.5rem;
            opacity: 0.9;
        }

        .subtitle {
            font-size: 0.85rem;
            color: #555;
            letter-spacing: 0.15em;
            text-transform: uppercase;
        }

        /* Center Event Info */
        .center-info {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            opacity: 0;
            transition: opacity 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            max-width: 400px;
        }

        .center-info.show {
            opacity: 1;
        }

        .center-event {
            font-size: 1.1rem;
            color: #888;
            letter-spacing: 0.05em;
            margin-bottom: 0.75rem;
            text-transform: uppercase;
            font-size: 0.8rem;
        }

        .center-time {
            font-size: 4rem;
            font-weight: 200;
            letter-spacing: -0.03em;
            margin-bottom: 0.5rem;
            line-height: 1;
        }

        .center-duration {
            font-size: 0.9rem;
            color: #666;
            letter-spacing: 0.05em;
            margin-bottom: 2rem;
        }

        /* RSVP Button */
        .rsvp-button {
            display: inline-block;
            padding: 1rem 3rem;
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 50px;
            color: #3b82f6;
            font-size: 0.9rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: auto;
            backdrop-filter: blur(10px);
        }

        .rsvp-button:hover {
            background: rgba(59, 130, 246, 0.2);
            border-color: rgba(59, 130, 246, 0.5);
            transform: translateY(-2px);
        }

        .rsvp-button:active {
            transform: translateY(0);
        }

        .instructions {
            position: absolute;
            bottom: 3rem;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            color: #555;
            font-size: 0.8rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
        }

        /* Duration labels on segments */
        .duration-label {
            position: absolute;
            font-size: 0.7rem;
            color: rgba(59, 130, 246, 0.6);
            letter-spacing: 0.05em;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.4s;
        }

        .duration-label.show {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div id="canvas-container"></div>

    <div class="ui-overlay">
        <div class="header">
            <h1 class="title">40 Hours with Caspar</h1>
            <p class="subtitle">Touch & Rotate</p>
        </div>

        <div class="center-info" id="centerInfo">
            <div class="center-event" id="centerEvent">Bowling</div>
            <div class="center-time" id="centerTime">20:00</div>
            <div class="center-duration" id="centerDuration">2h</div>
            <button class="rsvp-button" id="rsvpButton">RSVP Now</button>
        </div>

        <div class="instructions">Drag to explore • Touch events to RSVP</div>
    </div>

    <!-- Three.js + GSAP -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <script>
        const events = [
            {
                time: '20:00',
                endTime: '22:00',
                title: 'Bowling',
                location: 'Berolina Bowling Lounge',
                color: 0x3b82f6,
                image: 'https://images.unsplash.com/photo-1560707303-4e980ce876ad?w=400&h=400&fit=crop'
            },
            {
                time: '22:30',
                endTime: '23:59',
                title: 'New Oldtimer',
                location: 'Open end',
                color: 0x8b5cf6,
                image: 'https://images.unsplash.com/photo-1514933651103-005eec06c04b?w=400&h=400&fit=crop'
            },
            {
                time: '11:30',
                endTime: '14:00',
                title: 'Brunch',
                location: 'Mommseneck',
                color: 0xec4899,
                image: 'https://images.unsplash.com/photo-1533777857889-4be7c70b33f7?w=400&h=400&fit=crop'
            },
            {
                time: '14:00',
                endTime: '18:00',
                title: 'Art Walk',
                location: 'Charlottenburg',
                color: 0xf59e0b,
                image: 'https://images.unsplash.com/photo-1499781350541-7783f6c6a0c8?w=400&h=400&fit=crop'
            },
            {
                time: '19:00',
                endTime: '20:00',
                title: 'Workout',
                location: 'Ride.bln',
                color: 0x10b981,
                image: 'https://images.unsplash.com/photo-1534438327276-14e5300c3a48?w=400&h=400&fit=crop'
            },
            {
                time: '20:30',
                endTime: '22:30',
                title: 'Dinner',
                location: 'Ming Dynastie',
                color: 0x3b82f6,
                image: 'https://images.unsplash.com/photo-1559339352-11d035aa65de?w=400&h=400&fit=crop'
            },
            {
                time: '23:00',
                endTime: '01:00',
                title: 'Drinks',
                location: 'Viktoria Bar',
                color: 0x8b5cf6,
                image: 'https://images.unsplash.com/photo-1470337458703-46ad1756a187?w=400&h=400&fit=crop'
            }
        ];

        // Calculate duration
        function calculateDuration(start, end) {
            const startHour = parseInt(start.split(':')[0]);
            const endHour = parseInt(end.split(':')[0]);
            let duration = endHour - startHour;
            if (duration < 0) duration += 24; // Handle overnight
            return duration === 1 ? '1h' : `${duration}h`;
        }

        events.forEach(event => {
            event.duration = calculateDuration(event.time, event.endTime);
        });

        // Scene setup
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 8;

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        container.appendChild(renderer.domElement);

        // Main ring
        const ringGeometry = new THREE.TorusGeometry(3, 0.06, 32, 100);
        const ringMaterial = new THREE.MeshStandardMaterial({
            color: 0x1a1a1a,
            metalness: 0.8,
            roughness: 0.2,
            emissive: 0x0a0a0a
        });
        const ring = new THREE.Mesh(ringGeometry, ringMaterial);
        scene.add(ring);

        // Time segments with durations
        const segments = [];
        const segmentAngle = (Math.PI * 2) / events.length;

        events.forEach((event, i) => {
            const startAngle = i * segmentAngle;
            const endAngle = (i + 1) * segmentAngle;

            const segmentGeometry = new THREE.TorusGeometry(
                2.7, 0.15, 16, 32, endAngle - startAngle
            );
            const segmentMaterial = new THREE.MeshStandardMaterial({
                color: event.color,
                emissive: event.color,
                emissiveIntensity: 0,
                transparent: true,
                opacity: 0.3,
                metalness: 0.5,
                roughness: 0.3
            });

            const segment = new THREE.Mesh(segmentGeometry, segmentMaterial);
            segment.rotation.z = startAngle;
            segment.userData = { index: i, active: false };

            segments.push(segment);
            scene.add(segment);
        });

        // Event markers with images (billboard style)
        const markers = [];
        const textureLoader = new THREE.TextureLoader();

        events.forEach((event, i) => {
            const angle = (i / events.length) * Math.PI * 2;

            // Load image as texture
            const texture = textureLoader.load(event.image);

            // Create circular billboard
            const size = 0.8;
            const geometry = new THREE.CircleGeometry(size / 2, 32);
            const material = new THREE.MeshBasicMaterial({
                map: texture,
                transparent: true,
                opacity: 0.9,
                side: THREE.DoubleSide
            });

            const marker = new THREE.Mesh(geometry, material);
            marker.position.x = Math.cos(angle) * 3;
            marker.position.y = Math.sin(angle) * 3;
            marker.userData = { index: i, event, angle };

            // Add subtle border/glow
            const borderGeometry = new THREE.RingGeometry(size / 2, size / 2 + 0.02, 32);
            const borderMaterial = new THREE.MeshBasicMaterial({
                color: event.color,
                transparent: true,
                opacity: 0.3,
                side: THREE.DoubleSide
            });
            const border = new THREE.Mesh(borderGeometry, borderMaterial);
            marker.add(border);

            markers.push(marker);
            scene.add(marker);
        });

        // Lighting
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
        scene.add(ambientLight);

        const pointLight = new THREE.PointLight(0xffffff, 1, 100);
        pointLight.position.set(5, 5, 5);
        scene.add(pointLight);

        const fillLight = new THREE.PointLight(0x3b82f6, 0.3, 100);
        fillLight.position.set(-5, -5, 3);
        scene.add(fillLight);

        // Interaction
        let isDragging = false;
        let previousMouseX = 0;
        let rotationVelocity = 0;
        let currentActive = null;

        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();

        function onPointerDown(e) {
            isDragging = true;
            container.classList.add('dragging');
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            previousMouseX = clientX;
            rotationVelocity = 0;
        }

        function onPointerMove(e) {
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;

            mouse.x = (clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(clientY / window.innerHeight) * 2 + 1;

            if (isDragging) {
                const deltaX = clientX - previousMouseX;
                rotationVelocity = deltaX * 0.01;
                previousMouseX = clientX;
            }
        }

        function onPointerUp() {
            isDragging = false;
            container.classList.remove('dragging');
        }

        // Check for marker hover/touch
        function checkIntersections() {
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(markers);

            if (intersects.length > 0) {
                const index = intersects[0].object.userData.index;
                if (index !== undefined) activateEvent(index);
            } else if (!isDragging) {
                deactivateEvent();
            }
        }

        function activateEvent(index) {
            if (currentActive === index) return;

            // Deactivate previous
            if (currentActive !== null) {
                gsap.to(segments[currentActive].material, {
                    emissiveIntensity: 0,
                    duration: 0.5
                });
                gsap.to(markers[currentActive].scale, {
                    x: 1, y: 1, z: 1,
                    duration: 0.4,
                    ease: 'power2.out'
                });
                gsap.to(markers[currentActive].material, {
                    opacity: 0.9,
                    duration: 0.3
                });
            }

            currentActive = index;
            const event = events[index];

            // Activate segment
            gsap.to(segments[index].material, {
                emissiveIntensity: 0.8,
                duration: 0.6,
                ease: 'power2.out'
            });

            // Scale marker
            gsap.to(markers[index].scale, {
                x: 1.3, y: 1.3, z: 1.3,
                duration: 0.5,
                ease: 'elastic.out(1, 0.5)'
            });

            gsap.to(markers[index].material, {
                opacity: 1,
                duration: 0.3
            });

            // Update center info
            document.getElementById('centerEvent').textContent = event.title;
            document.getElementById('centerTime').textContent = event.time;
            document.getElementById('centerDuration').textContent = `${event.duration} • ${event.location}`;
            document.getElementById('centerInfo').classList.add('show');

            // Update RSVP button onclick
            document.getElementById('rsvpButton').onclick = () => {
                alert(`RSVP to ${event.title} at ${event.time}`);
                // In production, this would open your RSVP modal/page
            };

            // Haptic
            if (navigator.vibrate) navigator.vibrate(10);
        }

        function deactivateEvent() {
            if (currentActive === null) return;

            gsap.to(segments[currentActive].material, {
                emissiveIntensity: 0,
                duration: 0.5
            });

            gsap.to(markers[currentActive].scale, {
                x: 1, y: 1, z: 1,
                duration: 0.4,
                ease: 'power2.out'
            });

            gsap.to(markers[currentActive].material, {
                opacity: 0.9,
                duration: 0.3
            });

            document.getElementById('centerInfo').classList.remove('show');
            currentActive = null;
        }

        // Event listeners
        container.addEventListener('mousedown', onPointerDown);
        container.addEventListener('mousemove', onPointerMove);
        container.addEventListener('mouseup', onPointerUp);
        container.addEventListener('touchstart', onPointerDown, { passive: true });
        container.addEventListener('touchmove', onPointerMove, { passive: true });
        container.addEventListener('touchend', onPointerUp);

        // Animation loop
        function animate() {
            requestAnimationFrame(animate);

            // Smooth rotation with momentum
            if (!isDragging) {
                rotationVelocity *= 0.95;
            }

            ring.rotation.z += rotationVelocity;

            segments.forEach(segment => {
                segment.rotation.z += rotationVelocity;
            });

            markers.forEach(marker => {
                marker.userData.angle += rotationVelocity;
                const angle = marker.userData.angle;
                marker.position.x = Math.cos(angle) * 3;
                marker.position.y = Math.sin(angle) * 3;

                // Billboard effect - always face camera
                marker.lookAt(camera.position);
            });

            // Check intersections
            if (!isDragging) {
                checkIntersections();
            }

            // Subtle ring pulse
            ring.scale.setScalar(1 + Math.sin(Date.now() * 0.001) * 0.01);

            renderer.render(scene, camera);
        }

        // Handle resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Start
        animate();

        document.addEventListener('contextmenu', e => e.preventDefault());
    </script>
</body>
</html>
