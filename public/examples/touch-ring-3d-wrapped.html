<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Touch Ring - Wrapped Images</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #0a0a0a;
            color: #e8e8e8;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
            overflow: hidden;
            touch-action: none;
        }

        #canvas-container {
            position: fixed;
            inset: 0;
            cursor: grab;
        }

        #canvas-container.dragging {
            cursor: grabbing;
        }

        .ui-overlay {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 10;
        }

        .header {
            position: absolute;
            top: 3rem;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
        }

        .title {
            font-size: clamp(2rem, 5vw, 3.5rem);
            font-weight: 200;
            letter-spacing: -0.02em;
            margin-bottom: 0.5rem;
            opacity: 0.9;
        }

        .subtitle {
            font-size: 0.85rem;
            color: #555;
            letter-spacing: 0.15em;
            text-transform: uppercase;
        }

        .center-info {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            opacity: 0;
            transition: opacity 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            max-width: 400px;
        }

        .center-info.show {
            opacity: 1;
        }

        .center-event {
            font-size: 1.1rem;
            color: #888;
            letter-spacing: 0.05em;
            margin-bottom: 0.75rem;
            text-transform: uppercase;
            font-size: 0.8rem;
        }

        .center-time {
            font-size: 4rem;
            font-weight: 200;
            letter-spacing: -0.03em;
            margin-bottom: 0.5rem;
            line-height: 1;
        }

        .center-duration {
            font-size: 0.9rem;
            color: #666;
            letter-spacing: 0.05em;
            margin-bottom: 2rem;
        }

        .rsvp-button {
            display: inline-block;
            padding: 1rem 3rem;
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 50px;
            color: #3b82f6;
            font-size: 0.9rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: auto;
            backdrop-filter: blur(10px);
        }

        .rsvp-button:hover {
            background: rgba(59, 130, 246, 0.2);
            border-color: rgba(59, 130, 246, 0.5);
            transform: translateY(-2px);
        }

        .instructions {
            position: absolute;
            bottom: 3rem;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            color: #555;
            font-size: 0.8rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
        }
    </style>
</head>
<body>
    <div id="canvas-container"></div>

    <div class="ui-overlay">
        <div class="header">
            <h1 class="title">40 Hours with Caspar</h1>
            <p class="subtitle">3D Wrapped Version</p>
        </div>

        <div class="center-info" id="centerInfo">
            <div class="center-event" id="centerEvent">Bowling</div>
            <div class="center-time" id="centerTime">20:00</div>
            <div class="center-duration" id="centerDuration">2h</div>
            <button class="rsvp-button" id="rsvpButton">RSVP Now</button>
        </div>

        <div class="instructions">Drag to rotate • Touch to RSVP</div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <script>
        const events = [
            {
                time: '20:00',
                endTime: '22:00',
                title: 'Bowling',
                location: 'Berolina',
                color: 0x3b82f6,
                image: 'https://images.unsplash.com/photo-1560707303-4e980ce876ad?w=600&h=300&fit=crop'
            },
            {
                time: '22:30',
                endTime: '23:59',
                title: 'New Oldtimer',
                location: 'Open end',
                color: 0x8b5cf6,
                image: 'https://images.unsplash.com/photo-1514933651103-005eec06c04b?w=600&h=300&fit=crop'
            },
            {
                time: '11:30',
                endTime: '14:00',
                title: 'Brunch',
                location: 'Mommseneck',
                color: 0xec4899,
                image: 'https://images.unsplash.com/photo-1533777857889-4be7c70b33f7?w=600&h=300&fit=crop'
            },
            {
                time: '14:00',
                endTime: '18:00',
                title: 'Art Walk',
                location: 'Charlottenburg',
                color: 0xf59e0b,
                image: 'https://images.unsplash.com/photo-1499781350541-7783f6c6a0c8?w=600&h=300&fit=crop'
            },
            {
                time: '19:00',
                endTime: '20:00',
                title: 'Workout',
                location: 'Ride.bln',
                color: 0x10b981,
                image: 'https://images.unsplash.com/photo-1534438327276-14e5300c3a48?w=600&h=300&fit=crop'
            },
            {
                time: '20:30',
                endTime: '22:30',
                title: 'Dinner',
                location: 'Ming Dynastie',
                color: 0x3b82f6,
                image: 'https://images.unsplash.com/photo-1559339352-11d035aa65de?w=600&h=300&fit=crop'
            },
            {
                time: '23:00',
                endTime: '01:00',
                title: 'Drinks',
                location: 'Viktoria Bar',
                color: 0x8b5cf6,
                image: 'https://images.unsplash.com/photo-1470337458703-46ad1756a187?w=600&h=300&fit=crop'
            }
        ];

        function calculateDuration(start, end) {
            const startHour = parseInt(start.split(':')[0]);
            const endHour = parseInt(end.split(':')[0]);
            let duration = endHour - startHour;
            if (duration < 0) duration += 24;
            return duration === 1 ? '1h' : `${duration}h`;
        }

        events.forEach(event => {
            event.duration = calculateDuration(event.time, event.endTime);
        });

        // Scene setup
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 0, 8);

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        container.appendChild(renderer.domElement);

        // Ring with segments (each segment has its own image texture)
        const ringSegments = [];
        const segmentAngle = (Math.PI * 2) / events.length;
        const textureLoader = new THREE.TextureLoader();

        events.forEach((event, i) => {
            const startAngle = i * segmentAngle;
            const arcLength = segmentAngle;

            // Create torus segment with image texture
            const segmentGeometry = new THREE.TorusGeometry(
                3,           // radius
                0.4,         // tube radius (thicker to show image)
                16,          // radial segments
                50,          // tubular segments
                arcLength    // arc
            );

            // Load image texture
            const texture = textureLoader.load(event.image);
            texture.wrapS = THREE.RepeatWrapping;
            texture.wrapT = THREE.RepeatWrapping;

            const segmentMaterial = new THREE.MeshStandardMaterial({
                map: texture,
                emissive: event.color,
                emissiveIntensity: 0,
                metalness: 0.3,
                roughness: 0.6
            });

            const segment = new THREE.Mesh(segmentGeometry, segmentMaterial);
            segment.rotation.z = startAngle;
            segment.userData = {
                index: i,
                event,
                baseRotation: startAngle
            };

            ringSegments.push(segment);
            scene.add(segment);

            // Add glowing inner ring segment
            const glowGeometry = new THREE.TorusGeometry(
                2.5, 0.08, 16, 32, arcLength
            );
            const glowMaterial = new THREE.MeshStandardMaterial({
                color: event.color,
                emissive: event.color,
                emissiveIntensity: 0,
                transparent: true,
                opacity: 0.5
            });
            const glow = new THREE.Mesh(glowGeometry, glowMaterial);
            glow.rotation.z = startAngle;
            glow.userData = { index: i, isGlow: true };
            ringSegments.push(glow);
            scene.add(glow);
        });

        // Lighting
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
        scene.add(ambientLight);

        const pointLight = new THREE.PointLight(0xffffff, 1.2, 100);
        pointLight.position.set(5, 5, 5);
        scene.add(pointLight);

        const backLight = new THREE.PointLight(0x3b82f6, 0.5, 100);
        backLight.position.set(-5, -5, -3);
        scene.add(backLight);

        // Interaction
        let isDragging = false;
        let previousMouseX = 0;
        let rotationVelocity = 0;
        let currentActive = null;

        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();

        function onPointerDown(e) {
            isDragging = true;
            container.classList.add('dragging');
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            previousMouseX = clientX;
            rotationVelocity = 0;
        }

        function onPointerMove(e) {
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;

            mouse.x = (clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(clientY / window.innerHeight) * 2 + 1;

            if (isDragging) {
                const deltaX = clientX - previousMouseX;
                rotationVelocity = deltaX * 0.01;
                previousMouseX = clientX;
            }
        }

        function onPointerUp() {
            isDragging = false;
            container.classList.remove('dragging');
        }

        function checkIntersections() {
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(ringSegments.filter(s => !s.userData.isGlow));

            if (intersects.length > 0) {
                const index = intersects[0].object.userData.index;
                if (index !== undefined) activateEvent(index);
            } else if (!isDragging) {
                deactivateEvent();
            }
        }

        function activateEvent(index) {
            if (currentActive === index) return;

            // Deactivate previous
            if (currentActive !== null) {
                const prevSegment = ringSegments.find(s => s.userData.index === currentActive && !s.userData.isGlow);
                const prevGlow = ringSegments.find(s => s.userData.index === currentActive && s.userData.isGlow);

                if (prevSegment) {
                    gsap.to(prevSegment.material, { emissiveIntensity: 0, duration: 0.5 });
                    gsap.to(prevSegment.scale, { x: 1, y: 1, z: 1, duration: 0.4 });
                }
                if (prevGlow) {
                    gsap.to(prevGlow.material, { emissiveIntensity: 0, duration: 0.5 });
                }
            }

            currentActive = index;
            const event = events[index];

            // Activate current
            const segment = ringSegments.find(s => s.userData.index === index && !s.userData.isGlow);
            const glow = ringSegments.find(s => s.userData.index === index && s.userData.isGlow);

            if (segment) {
                gsap.to(segment.material, {
                    emissiveIntensity: 0.3,
                    duration: 0.6,
                    ease: 'power2.out'
                });
                gsap.to(segment.scale, {
                    x: 1.1, y: 1.1, z: 1.1,
                    duration: 0.5,
                    ease: 'elastic.out(1, 0.5)'
                });
            }

            if (glow) {
                gsap.to(glow.material, {
                    emissiveIntensity: 0.8,
                    duration: 0.6,
                    ease: 'power2.out'
                });
            }

            // Update UI
            document.getElementById('centerEvent').textContent = event.title;
            document.getElementById('centerTime').textContent = event.time;
            document.getElementById('centerDuration').textContent = `${event.duration} • ${event.location}`;
            document.getElementById('centerInfo').classList.add('show');

            document.getElementById('rsvpButton').onclick = () => {
                alert(`RSVP to ${event.title} at ${event.time}`);
            };

            if (navigator.vibrate) navigator.vibrate(10);
        }

        function deactivateEvent() {
            if (currentActive === null) return;

            const segment = ringSegments.find(s => s.userData.index === currentActive && !s.userData.isGlow);
            const glow = ringSegments.find(s => s.userData.index === currentActive && s.userData.isGlow);

            if (segment) {
                gsap.to(segment.material, { emissiveIntensity: 0, duration: 0.5 });
                gsap.to(segment.scale, { x: 1, y: 1, z: 1, duration: 0.4 });
            }
            if (glow) {
                gsap.to(glow.material, { emissiveIntensity: 0, duration: 0.5 });
            }

            document.getElementById('centerInfo').classList.remove('show');
            currentActive = null;
        }

        // Events
        container.addEventListener('mousedown', onPointerDown);
        container.addEventListener('mousemove', onPointerMove);
        container.addEventListener('mouseup', onPointerUp);
        container.addEventListener('touchstart', onPointerDown, { passive: true });
        container.addEventListener('touchmove', onPointerMove, { passive: true });
        container.addEventListener('touchend', onPointerUp);

        // Animation loop
        function animate() {
            requestAnimationFrame(animate);

            if (!isDragging) {
                rotationVelocity *= 0.95;
            }

            ringSegments.forEach(segment => {
                segment.rotation.z += rotationVelocity;
            });

            if (!isDragging) {
                checkIntersections();
            }

            renderer.render(scene, camera);
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        animate();
        document.addEventListener('contextmenu', e => e.preventDefault());
    </script>
</body>
</html>
